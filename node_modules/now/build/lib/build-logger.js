"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var _getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),_ansiEscapes=require("ansi-escapes"),_ansiEscapes2=_interopRequireDefault(_ansiEscapes),_socket=require("socket.io-client"),_socket2=_interopRequireDefault(_socket),_chalk=require("chalk"),_chalk2=_interopRequireDefault(_chalk),_events=require("events"),_events2=_interopRequireDefault(_events),Logger=function(e){function t(e){(0,_classCallCheck3["default"])(this,t);var s=(0,_possibleConstructorReturn3["default"])(this,(0,_getPrototypeOf2["default"])(t).call(this));return s.host=e,s.building=!1,s.socket=(0,_socket2["default"])("https://io.now.sh?host="+e),s.socket.once("error",s.onError.bind(s)),s.socket.on("state",s.onState.bind(s)),s.socket.on("logs",s.onLog.bind(s)),s.socket.on("backend",s.onComplete.bind(s)),s.lines=new Lines(10),s}return(0,_inherits3["default"])(t,e),(0,_createClass3["default"])(t,[{key:"onState",value:function(e){return e.id||(console.error("> Deployment not found"),this.emit("error")),e.backend?void this.onComplete():void(e.logs&&e.logs.forEach(this.onLog,this))}},{key:"onLog",value:function(e){var t=this;this.building||(console.log("> Building"),this.building=!0),"command"===e.type?(console.log(_chalk2["default"].gray(">")+" â–² "+e.data),this.lines.reset()):"stderr"===e.type?(e.data.split("\n").forEach(function(e){e.length&&console.error(_chalk2["default"].red("> "+e))}),this.lines.reset()):"stdout"===e.type&&e.data.split("\n").forEach(function(e){e.length&&t.lines.write(_chalk2["default"].gray(">")+" "+e)})}},{key:"onComplete",value:function(){this.socket.disconnect(),this.building&&(this.building=!1),this.emit("close")}},{key:"onError",value:function(){this.emit("error")}}]),t}(_events2["default"]);exports["default"]=Logger;var Lines=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?100:arguments[0];(0,_classCallCheck3["default"])(this,e),this.max=t,this.buf=[]}return(0,_createClass3["default"])(e,[{key:"write",value:function(e){var t=this.max,s=this.buf;s.length===t&&(process.stdout.write(_ansiEscapes2["default"].eraseLines(t+1)),s.shift(),s.forEach(function(e){return console.log(e)})),s.push(e),console.log(e)}},{key:"reset",value:function(){this.buf=[]}}]),e}();